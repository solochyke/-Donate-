<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transform a Life Today</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            width: 100%;
            margin: 2rem;
            background-color: #1a1a1a;
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            animation: fadeIn 1s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .hero-image {
            width: 100%;
            height: 350px;
            object-fit: cover;
            object-position: center;
        }
        .content {
            padding: 2.5rem;
        }
        .donate-button {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .donate-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 128, 0, 0.4);
        }
        .crypto-button {
            transition: transform 0.2s ease-in-out;
        }
        .crypto-button:hover {
            transform: translateY(-2px);
        }
        .message-box {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background-color: #333;
            color: #fff;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            z-index: 1000;
        }
        .message-box.show {
            opacity: 1;
            visibility: visible;
        }
        .tier-button {
            background-color: #2a2a2a;
            border: 1px solid #4a4a4a;
            transition: background-color 0.2s, transform 0.2s;
        }
        .tier-button:hover {
            background-color: #3a3a3a;
            transform: scale(1.02);
        }
        .pulse-animation {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal-content {
            background-color: #1a1a1a;
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: modalPop 0.3s ease-out;
        }
        @keyframes modalPop {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div class="message-box" id="messageBox" role="status" aria-live="polite"></div>

    <div class="container flex flex-col items-center text-center">
        <!-- AI-Generated Hero Image -->
        <img id="heroImage" src="https://placehold.co/800x350/6A5ACD/F8F8FF?text=Loading..." alt="AI generated hero image" class="hero-image rounded-t-2xl">

        <!-- Main Content -->
        <div class="content" role="main">
            <!-- AI-Generated Story -->
            <h1 id="main-title" class="text-4xl md:text-5xl font-extrabold text-orange-400 mb-4 tracking-tight">
                Loading a beautiful story...
            </h1>
            <p id="main-story" class="text-lg text-gray-400 mb-8 max-w-2xl mx-auto pulse-animation">
                <span id="loading-dots">...</span>
            </p>

            <!-- Donation Tiers -->
            <div class="mb-8">
                <h2 class="text-2xl font-semibold mb-4 text-gray-200">See Your Impact</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="handleStripeCheckout(25)" class="tier-button px-6 py-4 rounded-xl shadow-md text-left">
                        <span class="block text-3xl font-bold text-orange-400">$25</span>
                        <span class="block text-sm text-gray-400">Funds a new chef's knife for Maria's classes.</span>
                    </button>
                    <button onclick="handleStripeCheckout(50)" class="tier-button px-6 py-4 rounded-xl shadow-md text-left">
                        <span class="block text-3xl font-bold text-orange-400">$50</span>
                        <span class="block text-sm text-gray-400">Buys her a full set of kitchen tools and a uniform.</span>
                    </button>
                    <button onclick="handleStripeCheckout(100)" class="tier-button px-6 py-4 rounded-xl shadow-md text-left">
                        <span class="block text-3xl font-bold text-orange-400">$100</span>
                        <span class="block text-sm text-gray-400">Covers her tuition for an entire month, keeping her in school.</span>
                    </button>
                </div>
            </div>

            <div class="flex flex-col md:flex-row gap-4 justify-center items-center mb-6">
                <button onclick="handleStripeCheckout(150)" class="donate-button px-10 py-4 bg-orange-500 hover:bg-orange-600 text-white font-bold text-xl rounded-full shadow-lg">
                    Make a Difference Now
                </button>
            </div>
            
            <!-- Alternative Payment Options -->
            <p class="text-sm text-gray-500 mt-6 mb-4">
                Prefer to donate with cryptocurrency?
            </p>
            <div class="flex flex-col md:flex-row items-center gap-6 p-4 bg-gray-800 rounded-xl border border-gray-700">
                <!-- QR Code Image -->
                <div class="flex-shrink-0 w-32 h-32 md:w-40 md:h-40 bg-white rounded-xl flex items-center justify-center p-2">
                    <img id="qrCodeImage" src="https://ibb.co/DPzhQwyw" alt="QR Code" class="w-full h-full object-contain">
                </div>
                
                <!-- Crypto Address and Copy Button -->
                <div class="flex-grow flex flex-col items-center md:items-start text-center md:text-left">
                    <span class="text-xs text-gray-400 mb-2 font-medium">Scan or Copy Address</span>
                    <div class="relative w-full text-center md:text-left flex items-center">
                        <span id="cryptoAddress" class="text-sm md:text-base text-orange-400 font-mono select-all break-all pr-12">
                            0x0b5804bb54b485354f787c481e8f831e2c5b4903
                        </span>
                        <button onclick="copyCryptoAddress()" class="absolute right-0 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white transition-colors duration-200 p-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M16 1H4C2.9 1 2 1.9 2 3v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Thank You Modal -->
    <div id="thankYouModal" class="modal">
        <div class="modal-content">
            <h2 class="text-3xl font-extrabold text-orange-400 mb-4">Thank You!</h2>
            <p class="text-lg text-gray-300 mb-6">
                Your generosity has made a real difference. With your support, Maria is one step closer to her dream.
            </p>
            <button onclick="closeModal()" class="px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-full">
                Close
            </button>
        </div>
    </div>

    <script>
        // Use an IIFE for better code organization and to avoid global variable pollution.
        (function() {
            // Set up Stripe with your public key.
            const stripe = Stripe('pk_test_TYooMQauvdEDq5423uXzCxb4');

            // --- Core Functions ---
            
            window.handleStripeCheckout = async (amount) => {
                // IMPORTANT: In a production environment, this should call a backend endpoint
                // to create a Stripe Checkout Session. For this demo, we'll simulate it.
                //
                // const response = await fetch('/create-checkout-session', {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify({ amount: amount })
                // });
                // const session = await response.json();
                
                const sessionId = 'cs_test_a1qJz5Lg5A3y8Fj4pBq0xR2sK1tY7u';

                try {
                    const { error } = await stripe.redirectToCheckout({ sessionId: sessionId });
                    if (error) {
                        console.error('Stripe redirect error:', error);
                        showMessage('Failed to redirect to payment. Please try again.');
                    }
                } catch (e) {
                    console.error('Error during Stripe checkout:', e);
                    showMessage('An error occurred. Please try again.');
                }
            };

            window.copyCryptoAddress = () => {
                const address = document.getElementById('cryptoAddress').textContent.trim();
                
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(address).then(() => {
                        showMessage("Address copied to clipboard!");
                    }).catch(err => {
                        console.error('Could not copy text: ', err);
                        fallbackCopyTextToClipboard(address);
                    });
                } else {
                    fallbackCopyTextToClipboard(address);
                }
            };

            function fallbackCopyTextToClipboard(text) {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.top = "0";
                textArea.style.left = "0";
                textArea.style.width = "2em";
                textArea.style.height = "2em";
                textArea.style.padding = "0";
                textArea.style.border = "none";
                textArea.style.outline = "none";
                textArea.style.box-shadow = "none";
                textArea.style.background = "transparent";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                try {
                    const successful = document.execCommand('copy');
                    const msg = successful ? 'Successfully copied!' : 'Failed to copy!';
                    showMessage(msg);
                } catch (err) {
                    showMessage('Copying text failed, please try again.');
                    console.error('Fallback: Oops, unable to copy', err);
                }
                document.body.removeChild(textArea);
            }

            function showMessage(msg) {
                const messageBox = document.getElementById('messageBox');
                messageBox.textContent = msg;
                messageBox.classList.add('show');
                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, 3000);
            }

            window.showThankYouModal = () => {
                document.getElementById('thankYouModal').style.display = 'flex';
            };

            window.closeModal = () => {
                document.getElementById('thankYouModal').style.display = 'none';
            };

            // --- AI Generation Functions ---

            async function generateImage(prompt) {
                const heroImageElement = document.getElementById('heroImage');
                heroImageElement.classList.add('pulse-animation');
                heroImageElement.style.opacity = '0.5';

                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
                const payload = { 
                    instances: { prompt: prompt }, 
                    parameters: { "sampleCount": 1 } 
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    const base64Data = result?.predictions?.[0]?.bytesBase64Encoded;
                    
                    if (base64Data) {
                        heroImageElement.src = `data:image/png;base64,${base64Data}`;
                    } else {
                        heroImageElement.src = "https://placehold.co/800x350/FF6347/FFFFFF?text=Image+Generation+Failed";
                        console.error("No image data found in API response.");
                    }
                } catch (error) {
                    console.error('Image API Error:', error);
                    heroImageElement.src = "https://placehold.co/800x350/FF6347/FFFFFF?text=Image+Loading+Failed";
                } finally {
                    heroImageElement.classList.remove('pulse-animation');
                    heroImageElement.style.opacity = '1';
                }
            }

            async function generateStory(prompt) {
                const mainStoryElement = document.getElementById('main-story');
                const mainTitleElement = document.getElementById('main-title');
                mainTitleElement.classList.add('pulse-animation');
                
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const systemPrompt = "You are a professional copywriter for a non-profit organization. Your task is to write a single, short, emotionally compelling story (no more than 50-70 words) for a donation page. The story should introduce a person, their dream, the sudden obstacle they face, and how a donation can help them. The story should be written in the second person, addressing the reader directly and using phrases like 'Your gift is...' or 'Your help can...'. The tone should be hopeful and urgent. Do not include a title or any other text before the story.";
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                try {
                    let response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    let retries = 0;
                    const maxRetries = 5;
                    const baseDelay = 1000;
                    while (!response.ok && retries < maxRetries) {
                        const delay = baseDelay * Math.pow(2, retries);
                        await new Promise(res => setTimeout(res, delay));
                        response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        retries++;
                    }

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (generatedText) {
                        mainTitleElement.textContent = "Your Gift Can Change a Life Today.";
                        mainStoryElement.textContent = generatedText;
                    } else {
                        mainTitleElement.textContent = "Failed to load title.";
                        mainStoryElement.textContent = "Failed to load story. Please refresh the page.";
                    }
                } catch (error) {
                    console.error('Gemini API Error:', error);
                    mainStoryElement.textContent = "Failed to load story. Please try again later.";
                } finally {
                    mainStoryElement.classList.remove('pulse-animation');
                    mainTitleElement.classList.remove('pulse-animation');
                }
            }

            // --- Initialization ---

            document.addEventListener('DOMContentLoaded', () => {
                const storyAndImagePrompt = "A young baker whose oven broke, threatening to close her business.";
                
                // Start both API calls concurrently to speed up page load
                generateImage(storyAndImagePrompt);
                generateStory(`Write a story about a young baker who needs a new oven to save her small business.`);

                // Check if donation was successful
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('success')) {
                    showThankYouModal();
                }
            });
        })();
    </script>
</body>
	</html>
